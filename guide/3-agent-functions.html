

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Agent Behaviour &mdash; FLAME GPU 2 0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/collapsible-lists/css/tree_view.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Agent Communication" href="4-agent-communication.html" />
    <link rel="prev" title="Agents" href="2-agent.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >
          

          
            <a href="../index.html" class="icon icon-home"> FLAME GPU 2
          

          
            
            <img src="../_static/flamegpu2-icon-notext-128.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1-environment.html">The Model Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-agent.html">Agents</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Agent Behaviour</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#flamegpu-device-api">FLAMEGPU Device API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#agent-variable-access">Agent Variable Access</a></li>
<li class="toctree-l4"><a class="reference internal" href="#environment-property-access">Environment Property Access</a></li>
<li class="toctree-l4"><a class="reference internal" href="#random-number-generation">Random Number Generation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#communication-messaging">Communication (Messaging)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#agent-creation">Agent Creation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="4-agent-communication.html">Agent Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="5-host-functions.html">Environment Behaviour</a></li>
<li class="toctree-l2"><a class="reference internal" href="6-submodels.html">Submodels</a></li>
<li class="toctree-l2"><a class="reference internal" href="7-initialisation.html">Model Initialisation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/library_root.html">Library API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/class_view_hierarchy.html">Class Hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/file_view_hierarchy.html">File Hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/unabridged_api.html">Full API</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">FLAME GPU 2</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">User Guide</a> &raquo;</li>
        
      <li>Agent Behaviour</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/guide/3-agent-functions.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="agent-behaviour">
<h1>Agent Behaviour<a class="headerlink" href="#agent-behaviour" title="Permalink to this headline">¶</a></h1>
<p>Agent behaviour is defined using agent functions, agents can change their own state, send and read messages and create new agents.</p>
<p><strong>TODO General Description</strong></p>
<section id="flamegpu-device-api">
<h2>FLAMEGPU Device API<a class="headerlink" href="#flamegpu-device-api" title="Permalink to this headline">¶</a></h2>
<p>The FLAMEGPU Device API provides functionality within agent functions for
accessing simulation properties and managing the executing agent, usage of
this functionality is described below.</p>
<section id="agent-variable-access">
<h3>Agent Variable Access<a class="headerlink" href="#agent-variable-access" title="Permalink to this headline">¶</a></h3>
<p>Within agent functions, variables can be accessed with <code class="docutils literal notranslate"><span class="pre">setVariable</span></code> and <code class="docutils literal notranslate"><span class="pre">getVariable</span></code>.
These variables are accessed from higher latency device memory, so it’s recommended that you avoid multiple reads or writes to the same variable in any agent functions.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FLAMEGPU_AGENT_FUNCTION</span><span class="p">(</span><span class="n">ExampleFn</span><span class="p">,</span> <span class="n">MsgNone</span><span class="p">,</span> <span class="n">MsgNone</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Return agent variable &#39;x&#39; and store it in local variable &#39;x&#39;</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">getVariable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">);</span>
    <span class="c1">// Update the local copy</span>
    <span class="n">x</span><span class="o">++</span><span class="p">;</span>
    <span class="c1">// Store the updated local copy in the agent&#39;s &#39;x&#39; variable</span>
    <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">setVariable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ALIVE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Agent variables can also be arrays, accessing these requires extra arguments. It is not possible to retrieve or set a full array in a single function call, during agent functions, elements must be accessed individually.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FLAMEGPU_AGENT_FUNCTION</span><span class="p">(</span><span class="n">ExampleFn</span><span class="p">,</span> <span class="n">MsgNone</span><span class="p">,</span> <span class="n">MsgNone</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Return agent variable &#39;location[1]&#39; and store it in local variable &#39;y&#39;</span>
    <span class="c1">// The length of the array must be passed as the second template argument, in this example the array has a length of 3</span>
    <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">getVariable</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;location&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="c1">// Update the local copy</span>
    <span class="n">y</span><span class="o">++</span><span class="p">;</span>
    <span class="c1">// Store the updated local copy in the agent&#39;s &#39;location[1]&#39; variable</span>
    <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">setVariable</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;location&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ALIVE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="environment-property-access">
<h3>Environment Property Access<a class="headerlink" href="#environment-property-access" title="Permalink to this headline">¶</a></h3>
<p>Environment properties are read-only within agent functions (however they can be updated with host functions).</p>
<p>The pattern for reading environment properties is similar to agent variables. The syntax for array variables is slightly different, as the length of the array is not required, however elements are still accessed individually.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FLAMEGPU_AGENT_FUNCTION</span><span class="p">(</span><span class="n">ExampleFn</span><span class="p">,</span> <span class="n">MsgNone</span><span class="p">,</span> <span class="n">MsgNone</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Store the environment property &#39;a&#39; in local variable &#39;foo&#39;</span>
    <span class="kt">float</span> <span class="n">foo</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">environment</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">);</span>
    <span class="c1">// Store the environment array property &#39;b[1]&#39; in local variable &#39;bar&#39;</span>
    <span class="c1">// Unlike agent variables, the length of the array is not passed as a template argument</span>
    <span class="kt">float</span> <span class="n">bar</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">environment</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ALIVE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="random-number-generation">
<h3>Random Number Generation<a class="headerlink" href="#random-number-generation" title="Permalink to this headline">¶</a></h3>
<p>The agent function random number api is identical to that present in host functions. It is also seeded according to the random seed provided at model execution, making it preferable to external random libraries. Floating point uniform, normal and log normal distributions are available alongside range based integer distributions.</p>
<p>The main difference, is that uniformly distributed floats are in the range <code class="docutils literal notranslate"><span class="pre">(0-1]</span></code>, whereas host generation is in the range <code class="docutils literal notranslate"><span class="pre">[0-1)</span></code>. This is due to the underlying libraries used.</p>
<p><em>If unfamiliar with the range notation, square brackets</em> <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code> <em>denote the bound is inclusive whereas regular brackets</em> <code class="docutils literal notranslate"><span class="pre">(</span> <span class="pre">)</span></code> <em>represent an exclusive bound.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FLAMEGPU_AGENT_FUNCTION</span><span class="p">(</span><span class="n">ExampleFn</span><span class="p">,</span> <span class="n">MsgNone</span><span class="p">,</span> <span class="n">MsgNone</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate a uniform distributed random float in the range (0-1]</span>
    <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="c1">// Generate a normal distributed random double</span>
    <span class="kt">double</span> <span class="n">y</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">random</span><span class="p">.</span><span class="n">normal</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="c1">// Generate a log normal distributed random float</span>
    <span class="kt">float</span> <span class="n">z</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">random</span><span class="p">.</span><span class="n">logNormal</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="c1">// Generate a uniform random int in the range [5, 12]</span>
    <span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ALIVE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">float</span></code> may be replaced with <code class="docutils literal notranslate"><span class="pre">double</span></code>, similarly <code class="docutils literal notranslate"><span class="pre">int</span></code> may be
replaced with any suitable integer type (e.g. signed/unsigned:
<code class="docutils literal notranslate"><span class="pre">int8_t</span></code>, <code class="docutils literal notranslate"><span class="pre">int16_t</span></code>, <code class="docutils literal notranslate"><span class="pre">int32_t</span></code>, <code class="docutils literal notranslate"><span class="pre">int_64_t</span></code>).</p>
</section>
<section id="communication-messaging">
<h3>Communication (Messaging)<a class="headerlink" href="#communication-messaging" title="Permalink to this headline">¶</a></h3>
<p>Available messaging types and their usage is detailed in <span class="xref std std-doc">section 4</span>.</p>
</section>
<section id="agent-creation">
<h3>Agent Creation<a class="headerlink" href="#agent-creation" title="Permalink to this headline">¶</a></h3>
<p>The Device API’s agent creation interface is only able to create a single agent per instance of the
agent function. Additionally, the agent type and state being created must be earlier specified as
part of the model description.</p>
<p><strong>Note:</strong> <em>Agents created by agent functions do not exist until the next layer.</em></p>
<p>Model Definition:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ModelDescription</span> <span class="nf">model</span><span class="p">(</span><span class="s">&quot;example_model&quot;</span><span class="p">);</span>
<span class="n">AgentDescription</span> <span class="o">&amp;</span><span class="n">agent</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">newAgent</span><span class="p">(</span><span class="s">&quot;example_agent&quot;</span><span class="p">);</span>
<span class="c1">// Agents require atleast 1 variable</span>
<span class="n">agent</span><span class="p">.</span><span class="n">newVariable</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">);</span>
<span class="n">agent</span><span class="p">.</span><span class="n">newVariable</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
<span class="n">AgentFunctionDescription</span> <span class="o">&amp;</span><span class="n">function</span> <span class="o">=</span> <span class="n">agent</span><span class="p">.</span><span class="n">newFunction</span><span class="p">(</span><span class="s">&quot;example_function&quot;</span><span class="p">,</span> <span class="n">ExampleFn</span><span class="p">);</span>
<span class="c1">// The agent type &#39;example_agent&#39; is set as the agent output type</span>
<span class="n">function</span><span class="p">.</span><span class="n">setAgentOutput</span><span class="p">(</span><span class="n">agent</span><span class="p">);</span>
<span class="c1">// You can also enable optional agent output</span>
<span class="n">function</span><span class="p">.</span><span class="n">setAgentOutputOptional</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
<p>Agent Output from Device:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FLAMEGPU_AGENT_FUNCTION</span><span class="p">(</span><span class="n">ExampleFn</span><span class="p">,</span> <span class="n">MsgNone</span><span class="p">,</span> <span class="n">MsgNone</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// The output agent&#39;s &#39;x&#39; variable is set</span>
    <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">agent_out</span><span class="p">.</span><span class="n">setVariable</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="mf">12.0f</span><span class="p">);</span>
    <span class="c1">// The &#39;y&#39; variable has not been set, so will be set to it&#39;s default &#39;1.0f&#39;</span>
    <span class="k">return</span> <span class="n">ALIVE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="4-agent-communication.html" class="btn btn-neutral float-right" title="Agent Communication" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="2-agent.html" class="btn btn-neutral float-left" title="Agents" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, University of Sheffield.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>