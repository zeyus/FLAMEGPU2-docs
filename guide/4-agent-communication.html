

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Agent Communication &mdash; FLAME GPU 2 0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/collapsible-lists/css/tree_view.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Environment Behaviour" href="5-host-functions.html" />
    <link rel="prev" title="Agent Behaviour" href="3-agent-functions.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >
          

          
            <a href="../index.html" class="icon icon-home"> FLAME GPU 2
          

          
            
            <img src="../_static/flamegpu2-icon-notext-128.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1-environment.html">The Model Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-agent.html">Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-agent-functions.html">Agent Behaviour</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Agent Communication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#brute-force">Brute Force</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#model-definition">Model Definition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#message-access">Message Access</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#array">Array</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Model Definition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">Message Access</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#spatial">Spatial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">Model Definition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">Message Access</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#graph">Graph</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="5-host-functions.html">Environment Behaviour</a></li>
<li class="toctree-l2"><a class="reference internal" href="6-submodels.html">Submodels</a></li>
<li class="toctree-l2"><a class="reference internal" href="7-initialisation.html">Model Initialisation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/library_root.html">Library API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/class_view_hierarchy.html">Class Hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/file_view_hierarchy.html">File Hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/unabridged_api.html">Full API</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">FLAME GPU 2</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">User Guide</a> &raquo;</li>
        
      <li>Agent Communication</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/guide/4-agent-communication.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="agent-communication">
<h1>Agent Communication<a class="headerlink" href="#agent-communication" title="Permalink to this headline">¶</a></h1>
<p>FLAME GPU represents agent communication with messages. These are output by one group of
agents in a layer, and then read in a subsequent layer by the same, or a different, group of agents.</p>
<p>All messaging type can be optionally output, so that only a subset of agents executing the message
output agent function will produce a message.</p>
<p>Agents are able to read back their own message when iterating message lists.</p>
<p>FLAME GPU comes with several messaging options, described below. It can be extended to support
bespoke messaging types, for guidance on this see the file <code class="docutils literal notranslate"><span class="pre">include/flamegpu/runtime/messaging.h</span></code>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 30%" />
<col style="width: 55%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Symbol</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>Disabled</em></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MsgNone</span></code></p></td>
<td><p>No message type is active</p></td>
</tr>
<tr class="row-odd"><td><p>Brute Force</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MsgBruteForce</span></code></p></td>
<td><p>Access all messages</p></td>
</tr>
<tr class="row-even"><td><p>Spatial 2D</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MsgSpatial2D</span></code></p></td>
<td><p>Access all messages within a radius in 2D</p></td>
</tr>
<tr class="row-odd"><td><p>Spatial 3D</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MsgSpatial3D</span></code></p></td>
<td><p>Access all messages within a radius in 3D</p></td>
</tr>
<tr class="row-even"><td><p>Array 1D</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MsgArray1D</span></code></p></td>
<td><p>Directly access messages via a 1 dimensional array</p></td>
</tr>
<tr class="row-odd"><td><p>Array 2D</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MsgArray2D</span></code></p></td>
<td><p>Directly access messages via a 2 dimensional array</p></td>
</tr>
<tr class="row-even"><td><p>Array 3D</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MsgArray3D</span></code></p></td>
<td><p>Directly access messages via a 3 dimensional array</p></td>
</tr>
</tbody>
</table>
<div class="section" id="brute-force">
<h2>Brute Force<a class="headerlink" href="#brute-force" title="Permalink to this headline">¶</a></h2>
<p>Brute force messaging is the most basic type of messaging, whereby all messages are seen when
iterating the message list. Due to the high level of agents supported by FLAMEGPU, use of brute
force messaging should be limited to small agent populations and optional outputs. There is often
a more suitable message type.</p>
<p>An example of brute force messaging can be found in the <cite>circles_bruteforce</cite> example.</p>
<div class="section" id="model-definition">
<h3>Model Definition<a class="headerlink" href="#model-definition" title="Permalink to this headline">¶</a></h3>
<p>Defining the message’s variables:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">MsgBruteForce</span><span class="o">::</span><span class="n">Description</span> <span class="o">&amp;</span><span class="n">message</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">newMessage</span><span class="p">(</span><span class="s">&quot;location&quot;</span><span class="p">);</span>
<span class="n">message</span><span class="p">.</span><span class="n">newVariable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">);</span>
<span class="n">message</span><span class="p">.</span><span class="n">newVariable</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Adding the message as an input/output to agent functions</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Some agent defined elsewhere</span>
<span class="n">AgentDescription</span> <span class="o">&amp;</span><span class="n">agent</span> <span class="o">=</span> <span class="p">...;</span>
<span class="c1">// This agent has an output function &#39;output_message&#39;</span>
<span class="n">AgentFunctionDescription</span> <span class="o">&amp;</span><span class="n">output_fn</span> <span class="o">=</span> <span class="n">agent</span><span class="p">.</span><span class="n">newFunction</span><span class="p">(</span><span class="s">&quot;output_message&quot;</span><span class="p">,</span> <span class="n">output_message</span><span class="p">)</span>
<span class="c1">// &#39;output_message&#39; fn outputs the message &#39;location&#39;</span>
<span class="n">output_fn</span><span class="p">.</span><span class="n">setMessageOutput</span><span class="p">(</span><span class="s">&quot;location&quot;</span><span class="p">);</span>
<span class="c1">// The message output is optional</span>
<span class="n">output_fn</span><span class="p">.</span><span class="n">setMessageOutputOptional</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<span class="c1">// Similarly the agent has &#39;move&#39; function which reads the message &#39;location&#39;</span>
<span class="n">agent</span><span class="p">.</span><span class="n">newFunction</span><span class="p">(</span><span class="s">&quot;move&quot;</span><span class="p">,</span> <span class="n">move</span><span class="p">).</span><span class="n">setMessageInput</span><span class="p">(</span><span class="s">&quot;location&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="message-access">
<h3>Message Access<a class="headerlink" href="#message-access" title="Permalink to this headline">¶</a></h3>
<p>Outputting messages:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// The 3rd argument specifies the output message type as Brute Force messaging</span>
<span class="n">FLAMEGPU_AGENT_FUNCTION</span><span class="p">(</span><span class="n">output_message</span><span class="p">,</span> <span class="n">MsgNone</span><span class="p">,</span> <span class="n">MsgBruteForce</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Only agents with even id output the message</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">getVariable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Agent variables are set to match the agent&#39;s &#39;id&#39; and &#39;x&#39; variables.</span>
        <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">message_out</span><span class="p">.</span><span class="n">setVariable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">getVariable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">));</span>
        <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">message_out</span><span class="p">.</span><span class="n">setVariable</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">getVariable</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ALIVE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Reading messages:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// The 2nd argument specifies the input message type as Brute Force messaging</span>
<span class="n">FLAMEGPU_AGENT_FUNCTION</span><span class="p">(</span><span class="n">move</span><span class="p">,</span> <span class="n">MsgBruteForce</span><span class="p">,</span> <span class="n">MsgNone</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">ID</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">getVariable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">getVariable</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">// The message list is an iterable</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">message</span> <span class="p">:</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">message_in</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Check the ID variable to skip the agent&#39;s own message</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">getVariable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ID</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Process the remaining message variables</span>
            <span class="k">const</span> <span class="kt">float</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="n">getVariable</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">);</span>
            <span class="k">const</span> <span class="kt">float</span> <span class="n">separation</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">separation</span> <span class="o">&lt;</span> <span class="n">RADIUS</span> <span class="o">&amp;&amp;</span> <span class="n">separation</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">RADIUS</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">fx</span> <span class="o">+=</span> <span class="n">separation</span><span class="p">;</span>
                <span class="n">count</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">fx</span> <span class="o">/=</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nl">count</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="c1">// Update the agent according to the message processing result</span>
    <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">setVariable</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">fx</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ALIVE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="array">
<h2>Array<a class="headerlink" href="#array" title="Permalink to this headline">¶</a></h2>
<p>Array messaging is available in 1D, 2D and 3D, providing direct access to messages at a known location within an array.</p>
<p><strong>TODO</strong> Details on how optional output works.</p>
<p>It is also possible to iterate messages within a Moore neighbourhood of a selected element of the array.</p>
<p>An example of 2D array messaging can be found in the <cite>game_of_life</cite> example.</p>
<div class="section" id="id1">
<h3>Model Definition<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p><strong>TODO</strong></p>
</div>
<div class="section" id="id2">
<h3>Message Access<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p><strong>TODO</strong></p>
</div>
</div>
<div class="section" id="spatial">
<h2>Spatial<a class="headerlink" href="#spatial" title="Permalink to this headline">¶</a></h2>
<p>Spatial messaging is available in both 2D and 3D, providing access to a reduced subset of messages
which fall within a set radius. This message types force the inclusion of the <code class="docutils literal notranslate"><span class="pre">float</span></code> message
variables <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code> (and <code class="docutils literal notranslate"><span class="pre">z</span></code>). These are used internally by the data structure and correspond
to the location of the message.</p>
<p><strong>Note:</strong> <em>Spatial message access does not limit messages to those inside the radius. The user must
perform this bounds check manually. This is not performed automatically, to avoid duplication of
expensive distance calculations.</em></p>
<p>An example of spatial 3D messaging can be found in the <cite>circles_spatial3D</cite> example.</p>
<div class="section" id="id3">
<h3>Model Definition<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Defining the message’s variables:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Message type is specified as MsgSpatial2D</span>
<span class="n">MsgSpatial2D</span><span class="o">::</span><span class="n">Description</span> <span class="o">&amp;</span><span class="n">message</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">newMessage</span><span class="o">&lt;</span><span class="n">MsgSpatial2D</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;location&quot;</span><span class="p">);</span>
<span class="c1">// Add extra message variables</span>
<span class="n">message</span><span class="p">.</span><span class="n">newVariable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">);</span>
<span class="c1">// This is the search radius for message access, and must be set</span>
<span class="n">message</span><span class="p">.</span><span class="n">setRadius</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">);</span>
<span class="c1">// These are the bounds of the environment, and must be set</span>
<span class="c1">// messages that fall outside will have their location clamped (within the data structure&#39;s handling)</span>
<span class="n">message</span><span class="p">.</span><span class="n">setMin</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">message</span><span class="p">.</span><span class="n">setMax</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
</pre></div>
</div>
<p>The message is added to agent functions the same as all other messaging types. For an example see the
earlier examples for Brute Force messaging.</p>
</div>
<div class="section" id="id4">
<h3>Message Access<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Outputting messages:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// The 3rd argument specifies the output message type as Spatial 2D messaging</span>
<span class="n">FLAMEGPU_AGENT_FUNCTION</span><span class="p">(</span><span class="n">output_message</span><span class="p">,</span> <span class="n">MsgNone</span><span class="p">,</span> <span class="n">MsgSpatial2D</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Set extra message variables</span>
    <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">message_out</span><span class="p">.</span><span class="n">setVariable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">getVariable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">));</span>
    <span class="c1">// Spatial messaging add convenience methods for setting the 2D or 3D location with a single call</span>
    <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">message_out</span><span class="p">.</span><span class="n">setLocation</span><span class="p">(</span>
        <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">getVariable</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">),</span>
        <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">getVariable</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">ALIVE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Reading messages:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// The 2nd argument specifies the input message type as Brute Force messaging</span>
<span class="n">FLAMEGPU_AGENT_FUNCTION</span><span class="p">(</span><span class="n">move</span><span class="p">,</span> <span class="n">MsgBruteForce</span><span class="p">,</span> <span class="n">MsgNone</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">ID</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">getVariable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">);</span>
    <span class="c1">// Load user specified constants</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">REPULSE_FACTOR</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">environment</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;repulse&quot;</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">RADIUS</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">message_in</span><span class="p">.</span><span class="n">radius</span><span class="p">();</span>
    <span class="c1">// Load agent variables</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">getVariable</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">getVariable</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">// The message list is an iterable, the search origin is specified as (x1, y1, z1)</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">message</span> <span class="p">:</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">message_in</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">z1</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// Check the ID variable to skip the agent&#39;s own message</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">getVariable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ID</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">const</span> <span class="kt">float</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="n">getVariable</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">);</span>
            <span class="k">const</span> <span class="kt">float</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="n">getVariable</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">);</span>
            <span class="kt">float</span> <span class="n">x21</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">;</span>
            <span class="kt">float</span> <span class="n">y21</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">;</span>
            <span class="k">const</span> <span class="kt">float</span> <span class="n">separation</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x21</span><span class="o">*</span><span class="n">x21</span> <span class="o">+</span> <span class="n">y21</span><span class="o">*</span><span class="n">y21</span><span class="p">);</span>
            <span class="c1">// Calculate whether the message falls within the search radius</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">separation</span> <span class="o">&lt;</span> <span class="n">RADIUS</span> <span class="o">&amp;&amp;</span> <span class="n">separation</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Process the message</span>
                <span class="kt">float</span> <span class="n">k</span> <span class="o">=</span> <span class="n">sinf</span><span class="p">((</span><span class="n">separation</span> <span class="o">/</span> <span class="n">RADIUS</span><span class="p">)</span><span class="o">*</span><span class="mf">3.141</span><span class="o">*</span><span class="mi">-2</span><span class="p">)</span><span class="o">*</span><span class="n">REPULSE_FACTOR</span><span class="p">;</span>
                <span class="n">x21</span> <span class="o">/=</span> <span class="n">separation</span><span class="p">;</span>
                <span class="n">y21</span> <span class="o">/=</span> <span class="n">separation</span><span class="p">;</span>
                <span class="n">fx</span> <span class="o">+=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">x21</span><span class="p">;</span>
                <span class="n">fy</span> <span class="o">+=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">y21</span><span class="p">;</span>
                <span class="n">count</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">fx</span> <span class="o">/=</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nl">count</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">fy</span> <span class="o">/=</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nl">count</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="c1">// Update the agent according to the message processing result</span>
    <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">setVariable</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">fx</span><span class="p">);</span>
    <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">setVariable</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">fy</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ALIVE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="graph">
<h2>Graph<a class="headerlink" href="#graph" title="Permalink to this headline">¶</a></h2>
<p>Not yet available.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="5-host-functions.html" class="btn btn-neutral float-right" title="Environment Behaviour" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="3-agent-functions.html" class="btn btn-neutral float-left" title="Agent Behaviour" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, University of Sheffield.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>