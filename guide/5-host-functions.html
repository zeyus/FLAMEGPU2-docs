

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Environment Behaviour &mdash; FLAME GPU 2 0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/collapsible-lists/css/tree_view.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Submodels" href="6-submodels.html" />
    <link rel="prev" title="Agent Communication" href="4-agent-communication.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >
          

          
            <a href="../index.html" class="icon icon-home"> FLAME GPU 2
          

          
            
            <img src="../_static/flamegpu2-icon-notext-128.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1-environment.html">The Model Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-agent.html">Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-agent-functions.html">Agent Behaviour</a></li>
<li class="toctree-l2"><a class="reference internal" href="4-agent-communication.html">Agent Communication</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Environment Behaviour</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#host-functions">Host Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#types-of-host-function">Types of Host Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-host-functions">Using Host Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#flamegpu-host-api">FLAMEGPU Host API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#environment-property-access">Environment Property Access</a></li>
<li class="toctree-l4"><a class="reference internal" href="#random-number-generation">Random Number Generation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reduction">Reduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sorting-agents">Sorting Agents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#agent-creation">Agent Creation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="6-submodels.html">Submodels</a></li>
<li class="toctree-l2"><a class="reference internal" href="7-initialisation.html">Model Initialisation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/library_root.html">Library API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/class_view_hierarchy.html">Class Hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/file_view_hierarchy.html">File Hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/unabridged_api.html">Full API</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">FLAME GPU 2</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">User Guide</a> &raquo;</li>
        
      <li>Environment Behaviour</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/guide/5-host-functions.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="environment-behaviour">
<h1>Environment Behaviour<a class="headerlink" href="#environment-behaviour" title="Permalink to this headline">¶</a></h1>
<p>Environment behaviour is defined using host functions, these can perform analysis over the whole agent population, create new agents and update the environmental properties.</p>
<div class="section" id="host-functions">
<h2>Host Functions<a class="headerlink" href="#host-functions" title="Permalink to this headline">¶</a></h2>
<p>Host functions within FLAMEGPU provide a means to execute model logic at
a higher level than individual agents, these are executed on the CPU (as
opposed to agent functions which are executed on the GPU), with a
different FLAMEGPU api than is available within agent functions.</p>
<p>Host functions are most commonly used for creating new agents, managing
environmental constants and performing analytics over the agent
population.</p>
<p>They can either be executed as part of a layer, similar to agent
functions, or called relative to the whole simulation (init function,
exit function) or each time step (step function)</p>
<div class="section" id="types-of-host-function">
<h3>Types of Host Function<a class="headerlink" href="#types-of-host-function" title="Permalink to this headline">¶</a></h3>
<p>There are two forms of host function, functions and conditions, whereby
conditions must return a value.</p>
<p>These are added to a FLAMEGPU model as one of the below types: *
<strong>Init:</strong> Executes once at the start of the simulation. * <strong>Step:</strong>
Executes at the end of each simulation step. * <strong>Exit:</strong> Executes once
at the end of the simulation. * <strong>Host (Layer):</strong> Executes as part of
the specified layer. * <strong>Exit Condition:</strong> Executes at the end of each
simulation step, after step functions.</p>
<p>The only differences between them are how they are defined and if they
have any return value.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 42%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Macro</p></th>
<th class="head"><p>Return</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Init</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">FLAMEGPU_INIT_FUNCTION</span></code></p></td>
<td><p>n/a</p></td>
</tr>
<tr class="row-odd"><td><p>Step</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">FLAMEGPU_STEP_FUNCTION</span></code></p></td>
<td><p>n/a</p></td>
</tr>
<tr class="row-even"><td><p>Exit</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">FLAMEGPU_EXIT_FUNCTION</span></code></p></td>
<td><p>n/a</p></td>
</tr>
<tr class="row-odd"><td><p>Host (Layer)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">FLAMEGPU_HOST_FUNCTION</span></code></p></td>
<td><p>n/a</p></td>
</tr>
<tr class="row-even"><td><p>Exit Condition</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">FLAMEGPU_EXIT_CONDITION</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">CONTINUE</span></code> or <code class="docutils literal notranslate"><span class="pre">EXIT</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="using-host-functions">
<h3>Using Host Functions<a class="headerlink" href="#using-host-functions" title="Permalink to this headline">¶</a></h3>
<p>First the host function must be defined with one of the above listed
preprocessor macros, these expand to declare the function taking a
single argument <code class="docutils literal notranslate"><span class="pre">FLAMEGPU_HOST_API*</span> <span class="pre">FLAMEGPU</span></code>.</p>
<p>The two below examples show how host functions might be declared. ####
Example of a Host Function</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FLAMEGPU_STEP_FUNCTION</span><span class="p">(</span><span class="n">my_step_function</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Do something on the host!</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="example-of-a-host-condition">
<h4>Example of a Host Condition<a class="headerlink" href="#example-of-a-host-condition" title="Permalink to this headline">¶</a></h4>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FLAMEGPU_EXIT_CONDITION</span><span class="p">(</span><span class="n">my_exit_condition</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">someCondition</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">EXIT</span><span class="p">;</span>  <span class="c1">// End the simulation here</span>
    <span class="k">return</span> <span class="n">CONTINUE</span><span class="p">;</span>  <span class="c1">// Continue the simulation</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Most host functions can then be added directly to your <code class="docutils literal notranslate"><span class="pre">Simulation</span></code>
e.g.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Simulation</span> <span class="nf">simulation</span><span class="p">(</span><span class="n">flame_model</span><span class="p">);</span>
<span class="n">simulation</span><span class="p">.</span><span class="n">addInitFunction</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_init_function</span><span class="p">);</span>
<span class="n">simulation</span><span class="p">.</span><span class="n">addStepFunction</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_step_function</span><span class="p">);</span>
<span class="n">simulation</span><span class="p">.</span><span class="n">addExitFunction</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_exit_function</span><span class="p">);</span>
<span class="n">simulation</span><span class="p">.</span><span class="n">addExitCondition</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_exit_condition</span><span class="p">);</span>
</pre></div>
</div>
<p>Host (layer) functions are the exception to this, as they must be added
to a layer like agent functions:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">SimulationLayer</span> <span class="nf">my_layer</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="s">&quot;my_layer&quot;</span><span class="p">);</span>
<span class="n">my_layer</span><span class="p">.</span><span class="n">addAgentFunction</span><span class="p">(</span><span class="s">&quot;some_agent_function&quot;</span><span class="p">);</span>
<span class="n">my_layer</span><span class="p">.</span><span class="n">addHostFunction</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_host_function</span><span class="p">);</span>
<span class="n">simulation</span><span class="p">.</span><span class="n">addSimulationLayer</span><span class="p">(</span><span class="n">my_layer</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Note:</strong> <em>``FLAMEGPU_***_FUNCTION`` macros can be used interchangeably,
if a host function is required in multiple locations (e.g. Init and
Step). The naming simply ensures improved visibility of function
purpose.</em></p>
</div>
</div>
</div>
<div class="section" id="flamegpu-host-api">
<h2>FLAMEGPU Host API<a class="headerlink" href="#flamegpu-host-api" title="Permalink to this headline">¶</a></h2>
<p>The FLAMEGPU Host API provides functionality within host functions for
managing the simulation, usage of this functionality is described below.</p>
<div class="section" id="environment-property-access">
<h3>Environment Property Access<a class="headerlink" href="#environment-property-access" title="Permalink to this headline">¶</a></h3>
<p>Environment properties can be read and updated during host functions and
conditions (with the exception of properties that were marked as
constant, they cannot be changed), these can then be read during agent
functions.</p>
<p>The Host API’s methods for accessing environmental properties is very similar
to that used to initialise the environment properties via
<code class="docutils literal notranslate"><span class="pre">EnvironmentDescription</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>FLAMEGPU_HOST_FUNCTION(my_host_function) {
    // Get property &#39;f_prop&#39;, type &#39;float&#39;
    float float_prop = FLAMEGPU-&gt;environment.get&lt;float&gt;(&#39;f_prop&#39;);
    // Get property array &#39;ia_prop&#39;, length 4, type &#39;int&#39;
    std::array&lt;int, 4&gt; int_prop = FLAMEGPU-&gt;environment.get&lt;int, 4&gt;(&#39;ia_prop&#39;);
    // Get the 2nd element, from property array `ia_prop`, type &#39;int&#39;
    int ia_prop1 = FLAMEGPU-&gt;environment.get&lt;int, 4&gt;(&#39;ia_prop&#39;, 1);  // Elements are 0-indexed
    // Set &#39;fprop&#39;
    FLAMEGPU-&gt;environment.set&lt;float&gt;(&#39;f_prop&#39;, 12.0f);
    // Set &#39;ia_prop&#39;
    FLAMEGPU-&gt;environment.set&lt;int, 4&gt;(&#39;ia_prop&#39;, {12, 13, 14, 15});
    // Set &#39;ia_prop[1]&#39;
    FLAMEGPU-&gt;environment.set&lt;int&gt;(&#39;ia_prop&#39;, 1, 13);
}
</pre></div>
</div>
<p>Environment properties can also be created and removed during
simulations, however this is discouraged as it may impact performance.</p>
</div>
<div class="section" id="random-number-generation">
<h3>Random Number Generation<a class="headerlink" href="#random-number-generation" title="Permalink to this headline">¶</a></h3>
<p>The Host API’s random interface is identical to that available from the
Device API. It is also seeded according to the random seed provided at
model execution, making it preferable to external random libraries.</p>
<p>Example usage:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FLAMEGPU_HOST_FUNCTION</span><span class="p">(</span><span class="n">my_host_function</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// uniformly distributed float in the range [0-1)</span>
    <span class="kt">float</span> <span class="n">uniform_real</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="c1">// uniformly distributed int in the range [1-10]</span>
    <span class="kt">int</span> <span class="n">uniform_int</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    <span class="c1">// normally distributed float with mean==1, std_dev=1</span>
    <span class="kt">float</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">random</span><span class="p">.</span><span class="n">normal</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="c1">// log normally distributed float with mean==1, std_dev=1</span>
    <span class="kt">float</span> <span class="n">logNormal</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">random</span><span class="p">.</span><span class="n">logNormal</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">float</span></code> may be replaced with <code class="docutils literal notranslate"><span class="pre">double</span></code>, similarly <code class="docutils literal notranslate"><span class="pre">int</span></code> may be
replaced with any suitable integer type (e.g. signed/unsigned:
<code class="docutils literal notranslate"><span class="pre">int8_t</span></code>, <code class="docutils literal notranslate"><span class="pre">int16_t</span></code>, <code class="docutils literal notranslate"><span class="pre">int32_t</span></code>, <code class="docutils literal notranslate"><span class="pre">int_64_t</span></code>).</p>
</div>
<div class="section" id="reduction">
<h3>Reduction<a class="headerlink" href="#reduction" title="Permalink to this headline">¶</a></h3>
<p>The Host API offers several types of reduction which can be performed
over agent variables.</p>
<ul>
<li><p><strong>Min:</strong> Find the minimum value.</p></li>
<li><p><strong>Max:</strong> Find the maximum value.</p></li>
<li><p><strong>Sum:</strong> Sum all of the values.</p></li>
<li><p><strong>Count:</strong> Count occurences of a specific value.</p></li>
<li><p><strong>Reduce:</strong> Perform a reduction with a custom binary operator.</p></li>
<li><p><strong>TransformReduce:</strong> Perform a transformation + reduction with custom
unary and binary operators.</p></li>
<li><p><strong>Histogram Even:</strong> Generate a histogram of all values, with evenly
spaced bin boundaries.</p>
<p>Min/Max are performed by specifying the agent name, variable name and</p>
</li>
</ul>
<p>variable’s type:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FLAMEGPU_HOST_FUNCTION</span><span class="p">(</span><span class="n">my_host_function</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">myAgent</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">agent</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">);</span>
    <span class="c1">// min/max of agent &#39;red&#39;s float variable `x`</span>
    <span class="kt">float</span> <span class="n">minResult</span> <span class="o">=</span> <span class="n">myAgent</span><span class="p">.</span><span class="n">min</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">maxResult</span> <span class="o">=</span> <span class="n">myAgent</span><span class="p">.</span><span class="n">max</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Sum is performed similarly, however a second template argument can be
used if the result is likely to require a greater type to avoid
overflow:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FLAMEGPU_HOST_FUNCTION</span><span class="p">(</span><span class="n">my_host_function</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">myAgent</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">agent</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">);</span>
    <span class="c1">// sum of agent &#39;red&#39;s int16_t variable `y`</span>
    <span class="kt">int16_t</span> <span class="n">int16_result</span> <span class="o">=</span> <span class="n">myAgent</span><span class="p">.</span><span class="n">sum</span><span class="o">&lt;</span><span class="kt">int16_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">);</span>
    <span class="c1">// sum int16 into int_64</span>
    <span class="kt">int64_t</span> <span class="n">int64_result</span> <span class="o">=</span> <span class="n">myAgent</span><span class="p">.</span><span class="n">sum</span><span class="o">&lt;</span><span class="kt">int16_t</span><span class="p">,</span> <span class="kt">int64_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Count takes a second argument, this provides the value to be tested for
equality, it always returns an <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FLAMEGPU_HOST_FUNCTION</span><span class="p">(</span><span class="n">my_host_function</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">myAgent</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">agent</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">);</span>
    <span class="c1">// count occurences of &#39;0&#39; within of agent &#39;red&#39;s int variable `z`</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">countResult</span> <span class="o">=</span> <span class="n">myAgent</span><span class="p">.</span><span class="n">count</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;z&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Custom reduce’s are useful if you require a binary operation not
provided natively by FLAMEGPU, the final argument specifies the initial
value for the reduction:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FLAMEGPU_CUSTOM_REDUCTION</span><span class="p">(</span><span class="n">customMin</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// return minimum value above 0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">b</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">a</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span> <span class="o">?</span> <span class="nl">a</span> <span class="p">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">FLAMEGPU_HOST_FUNCTION</span><span class="p">(</span><span class="n">my_host_function</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">myAgent</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">agent</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">);</span>
    <span class="c1">// apply &#39;customMin&#39; reduction to agent &#39;red&#39;s variable &#39;x&#39;</span>
    <span class="c1">// INT_MAX is the initial value provided to the reduction</span>
    <span class="kt">int</span> <span class="n">myMinResult</span> <span class="o">=</span> <span class="n">myAgent</span><span class="p">.</span><span class="n">reduce</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;z&quot;</span><span class="p">,</span> <span class="n">customMin</span><span class="p">,</span> <span class="n">INT_MAX</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Custom transform-reduce’s are useful if you require a binary operation,
preceded by a transformation. Like the custom reduce, the final argument
specifies the initial value for the reduction. It is also possible for
the transform operator to change the type of the variable:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FLAMEGPU_CUSTOM_TRANSFORMATION</span><span class="p">(</span><span class="n">customEqualsIf</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// return false if greater than 0</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">FLAMEGPU_CUSTOM_REDUCTION</span><span class="p">(</span><span class="n">customSum</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// return sum of values</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">FLAMEGPU_HOST_FUNCTION</span><span class="p">(</span><span class="n">my_host_function</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">myAgent</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">agent</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">);</span>
    <span class="c1">// apply &#39;customEqualsIf&#39; transformation to agent &#39;red&#39;s variable &#39;x&#39;</span>
    <span class="c1">// following, apply `customSum` reduction</span>
    <span class="c1">// 0 is the initial value provided to the reduction</span>
    <span class="kt">uint16_t</span> <span class="n">countIf_out</span> <span class="o">=</span> <span class="n">myAgent</span><span class="p">.</span><span class="n">transformReduce</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span> <span class="kt">uint16_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;z&quot;</span><span class="p">,</span> <span class="n">customEqualsIf</span><span class="p">,</span> <span class="n">customSum</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A histogram of values held by an agent variable can also be produced,
this requires additional arguments to specify the number of bins and
bounds of the histogram:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FLAMEGPU_HOST_FUNCTION</span><span class="p">(</span><span class="n">my_host_function</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">myAgent</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">agent</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">);</span>
    <span class="c1">// Create a histogram of agent &#39;red&#39;s variable &#39;z&#39;</span>
    <span class="c1">// 10 bins, inclusive lower bound 0, exclusive upper bound 100</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">hist</span> <span class="o">=</span> <span class="n">myAgent</span><span class="p">.</span><span class="n">histogramEven</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;z&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="sorting-agents">
<h3>Sorting Agents<a class="headerlink" href="#sorting-agents" title="Permalink to this headline">¶</a></h3>
<p><strong>TODO</strong></p>
</div>
<div class="section" id="agent-creation">
<h3>Agent Creation<a class="headerlink" href="#agent-creation" title="Permalink to this headline">¶</a></h3>
<p>The Host API’s agent creation interface is identical to that available from the
Device API. However, agents of any valid type and state can be created
(whereas the Device API requires the type and state be specified in the model description).</p>
<p>Host agent creation should be used sparingly as it may impact performance if large numbers
of agents are regularly being created on the host.</p>
<p><strong>Note:</strong> <em>Agents created by host functions do not exist until after all host functions,
at the current layer have completed. Such that, host reductions will not account for newly
created agents straight away.</em></p>
<dl class="simple">
<dt><strong>Note:</strong> <a href="#id1"><span class="problematic" id="id2">*</span></a>Agents created in an exit condition which returns <code class="docutils literal notranslate"><span class="pre">EXIT</span></code> or an exit function</dt><dd><p>will never exist.*</p>
</dd>
</dl>
<p>Example usage:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FLAMEGPU_HOST_FUNCTION</span><span class="p">(</span><span class="n">my_host_function</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// Create an agent of type &#39;red&#39; in the initial_state (specified in agent description)</span>
     <span class="c1">// Set the new agent&#39;s &#39;z&#39; variable to a random number [1,10]</span>
     <span class="k">auto</span> <span class="n">newAgt</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">newAgent</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">);</span>
     <span class="n">newAgt</span><span class="p">.</span><span class="n">setVariable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;z&quot;</span><span class="p">,</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">));</span>
     <span class="c1">// Create a second agent of type &#39;red&#39;, this time in the state &#39;off&#39;</span>
     <span class="c1">// Assign the new agent&#39;s &#39;x&#39; variable -1</span>
     <span class="k">auto</span> <span class="n">newAgt2</span> <span class="o">=</span> <span class="n">FLAMEGPU</span><span class="o">-&gt;</span><span class="n">newAgent</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;off&quot;</span><span class="p">);</span>
     <span class="n">newAgt2</span><span class="p">.</span><span class="n">setVariable</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="mf">-1.0f</span><span class="p">);</span>
     <span class="c1">// Variables not set here, will be set to their default values (specified in the agent description)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="6-submodels.html" class="btn btn-neutral float-right" title="Submodels" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="4-agent-communication.html" class="btn btn-neutral float-left" title="Agent Communication" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, University of Sheffield.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>