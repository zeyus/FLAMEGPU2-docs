

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Submodels &mdash; FLAME GPU 2 0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/collapsible-lists/css/tree_view.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Model Initialisation" href="7-initialisation.html" />
    <link rel="prev" title="Environment Behaviour" href="5-host-functions.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >
          

          
            <a href="../index.html" class="icon icon-home"> FLAME GPU 2
          

          
            
            <img src="../_static/flamegpu2-icon-notext-128.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1-environment.html">The Model Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-agent.html">Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-agent-functions.html">Agent Behaviour</a></li>
<li class="toctree-l2"><a class="reference internal" href="4-agent-communication.html">Agent Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="5-host-functions.html">Environment Behaviour</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Submodels</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#submodel-definition">SubModel Definition</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="7-initialisation.html">Model Initialisation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/library_root.html">Library API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/class_view_hierarchy.html">Class Hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/file_view_hierarchy.html">File Hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/unabridged_api.html">Full API</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">FLAME GPU 2</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">User Guide</a> &raquo;</li>
        
      <li>Submodels</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/guide/6-submodels.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="submodels">
<h1>Submodels<a class="headerlink" href="#submodels" title="Permalink to this headline">¶</a></h1>
<p>Submodels are a new feature to FLAMEGPU2, providing a more flexible and intuitive interface for iterative algorithms. These were previously handled in FLAMEGPU1 with global function conditions.</p>
<p>A submodel acts as a full model nested inside a parent model, the only requirement is that the model contains atleast one exit condition. Agent variables can be mapped between the two models, with each model also having private agent variables (or even private agents). Environment properties can also be shared with submodels, with the ability to mark them as constant within the submodel.</p>
<p>Where an agent variable is mapped between model and submodel, the parent model’s default value will always be used when creating new agents.</p>
<p>A submodel must exist independently within a layer of the parent model, it cannot execute simultaneously with other agent or host functions.</p>
<p>Models may contain multiple submodels, and submodels may contain sub-submodels. The only limitation to submodel nested, is that circular dependencies are not permitted (e.g. a submodel adding it’s parent model as a submodel).</p>
<p>An example of submodel usage can be found in the <cite>sugarscape</cite> example.</p>
<div class="section" id="submodel-definition">
<h2>SubModel Definition<a class="headerlink" href="#submodel-definition" title="Permalink to this headline">¶</a></h2>
<p>A submodel as defined the same as a regular model, via a <cite>ModelDescription</cite>. It must then be added to the model which should host the submodel. Mappings between agent states, agent variables and environment properties can then be created. When mapping variables and properties, they must be of the same type and length.</p>
<p>When calling <cite>SubAgentDescription::bindAgent()</cite>, it is also possible to automatically bind compatible states and variables.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Define a submodel</span>
<span class="n">ModelDescription</span> <span class="nf">sub_m</span><span class="p">(</span><span class="s">&quot;submodel&quot;</span><span class="p">);</span>
<span class="p">{</span>
    <span class="c1">// Define a simple agent with variable &#39;x&#39; and state &#39;foo&#39;</span>
    <span class="n">AgentDescription</span> <span class="o">&amp;</span><span class="n">a</span> <span class="o">=</span> <span class="n">sub_m</span><span class="p">.</span><span class="n">newAgent</span><span class="p">(</span><span class="s">&quot;subagent&quot;</span><span class="p">);</span>
    <span class="n">a</span><span class="p">.</span><span class="n">newVariable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">);</span>
    <span class="n">a</span><span class="p">.</span><span class="n">newState</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
    <span class="c1">// Add an agent function to the model</span>
    <span class="n">AgentFunctionDescription</span> <span class="o">&amp;</span><span class="n">af1</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">newFunction</span><span class="p">(</span><span class="s">&quot;example_function&quot;</span><span class="p">,</span> <span class="n">ExampleFn</span><span class="p">);</span>
    <span class="n">sub_m</span><span class="p">.</span><span class="n">newLayer</span><span class="p">().</span><span class="n">addFunction</span><span class="p">(</span><span class="n">af1</span><span class="p">);</span>
    <span class="c1">// Give the model an exit condition, this is required for all submodels</span>
    <span class="n">sub_m</span><span class="p">.</span><span class="n">addExitCondition</span><span class="p">(</span><span class="n">ExitCdn</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Define the parent model</span>
<span class="n">ModelDescription</span> <span class="n">m</span><span class="p">(</span><span class="s">&quot;model&quot;</span><span class="p">);</span>
<span class="p">{</span>
    <span class="c1">// Define a simple agent with variable &#39;y&#39; and state &#39;bar&#39;</span>
    <span class="n">AgentDescription</span> <span class="o">&amp;</span><span class="n">a</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">newAgent</span><span class="p">(</span><span class="s">&quot;agent&quot;</span><span class="p">);</span>
    <span class="n">a</span><span class="p">.</span><span class="n">newVariable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">);</span>
    <span class="n">a</span><span class="p">.</span><span class="n">newState</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">);</span>
    <span class="c1">// Add the submodel</span>
    <span class="n">SubModelDescription</span> <span class="o">&amp;</span><span class="n">smd</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">newSubModel</span><span class="p">(</span><span class="s">&quot;sub&quot;</span><span class="p">,</span> <span class="n">sub_m</span><span class="p">);</span>
    <span class="c1">// Map agent&#39;s foo and bar</span>
    <span class="c1">// We pass false, as we don&#39;t wish for matching variables and states to be automatically mapped</span>
    <span class="n">SubAgentDescription</span> <span class="o">&amp;</span><span class="n">agent_map</span> <span class="o">=</span> <span class="n">smd</span><span class="p">.</span><span class="n">bindAgent</span><span class="p">(</span><span class="s">&quot;subagent&quot;</span><span class="p">,</span> <span class="s">&quot;agent&quot;</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
    <span class="c1">// Map the agent variables and states</span>
    <span class="n">agent_map</span><span class="p">.</span><span class="n">mapState</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>
    <span class="n">agent_map</span><span class="p">.</span><span class="n">mapVariable</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">)</span>
    <span class="c1">// Add the submodel to a layer</span>
    <span class="n">m</span><span class="p">.</span><span class="n">newLayer</span><span class="p">().</span><span class="n">addSubModel</span><span class="p">(</span><span class="n">smd</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Environment properties are also mapped similarly. It is not possible to map a non-const environment property within a submodel, to a const property in the parent model.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Define a submodel</span>
<span class="n">ModelDescription</span> <span class="nf">sub_m</span><span class="p">(</span><span class="s">&quot;submodel&quot;</span><span class="p">);</span>
<span class="c1">// As this property will be mapped, it&#39;s value is redundant as it will always be inherited</span>
<span class="n">sub_m</span><span class="p">.</span><span class="n">Environment</span><span class="p">().</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">sub_m</span><span class="p">.</span><span class="n">Environment</span><span class="p">().</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;foo2&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

<span class="c1">// Define the parent model</span>
<span class="n">ModelDescription</span> <span class="nf">m</span><span class="p">(</span><span class="s">&quot;model&quot;</span><span class="p">);</span>
<span class="n">m</span><span class="p">.</span><span class="n">Environment</span><span class="p">().</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="mf">12.0f</span><span class="p">);</span>
<span class="n">m</span><span class="p">.</span><span class="n">Environment</span><span class="p">().</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;bar2&quot;</span><span class="p">,</span> <span class="mf">21.0f</span><span class="p">);</span>

<span class="c1">// Setup the mapping</span>
<span class="n">SubModelDescription</span> <span class="o">&amp;</span><span class="n">smd</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">newSubModel</span><span class="p">(</span><span class="s">&quot;sub&quot;</span><span class="p">,</span> <span class="n">sub_m</span><span class="p">);</span>
<span class="n">SubEnvironmentDescription</span> <span class="o">&amp;</span><span class="n">senv</span> <span class="o">=</span> <span class="n">smd</span><span class="p">.</span><span class="n">SubEnvironment</span><span class="p">();</span>
<span class="n">senv</span><span class="p">.</span><span class="n">mapProperty</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">);</span>
<span class="n">senv</span><span class="p">.</span><span class="n">mapProperty</span><span class="p">(</span><span class="s">&quot;foo2&quot;</span><span class="p">,</span> <span class="s">&quot;bar2&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="7-initialisation.html" class="btn btn-neutral float-right" title="Model Initialisation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="5-host-functions.html" class="btn btn-neutral float-left" title="Environment Behaviour" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, University of Sheffield.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>